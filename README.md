
---

# โปรแกรมจัดการข้อมูลการประกันภัยรถยนต์ (CSV)

อ่าน/เขียนไฟล์ CSV, เพิ่ม (Add), ค้นหา (Search), แสดงข้อมูลทั้งหมด (List All), อัปเดตข้อมูล (Update), ลบข้อมูล (Delete) พร้อมตรวจรูปแบบเลขกรมธรรม์และวันที่

## สถานะปัจจุบัน: ทำได้แล้ว

* **อ่าน/บันทึกไฟล์ CSV** ชื่อเริ่มต้น `policies.csv` พร้อมหัวตาราง
  ฟอร์แมตคอลัมน์: `PolicyNumber,OwnerName,CarModel,StartDate`
* **เพิ่มข้อมูล (Add)**

  * ตรวจรูปแบบเลขกรมธรรม์: ตัวอักษร 1 ตัว + ตัวเลข 1–3 หลัก → แปลงเป็นมาตรฐาน **A000–Z999** (เช่น `p23 → P023`)
  * รับวันที่ได้ทั้ง `YYYY M D` และ `YYYY-M-D` → แปลงเป็น `YYYY-MM-DD`
  * **กันข้อมูลซ้ำ** (เช็คจาก `PolicyNumber` แบบมาตรฐาน)
  * **บันทึก CSV อัตโนมัติทันที** หลังเพิ่มสำเร็จ และแจ้งรายละเอียดที่บันทึก
  * ย้อนกลับได้ด้วยการกรอก `0` และถามต่อท้าย “Add more? (y/n)”
* **ค้นหา (Search)**

  * ค้นได้ 3 แบบ: ตาม **policy number / owner name / car model**
  * แสดงผลเป็นตาราง + **สรุปจำนวน** “Found N record(s).”
* **แสดงทั้งหมด (List all policies)**

  * แสดงตารางทุกเรคคอร์ด + **Total policies: N** ท้ายตาราง
  * ลบแถวที่เป็น **header ซ้ำ** ออกจากหน่วยความจำก่อนแสดง (กันไฟล์ที่มีหัวตารางซ้ำ)
* **อัปเดต (Update) – ใช้งานจริงแล้ว**

  * รูปแบบ: พิมพ์เลขกรมธรรม์ → แปลงมาตรฐาน → แสดงข้อมูลเดิม → กรอกค่าที่จะเปลี่ยน
    (พิมพ์ `-` เพื่อ **ไม่แก้** ฟิลด์นั้น)
  * ตรวจรูปแบบวันที่ใหม่ (ถ้ากรอก) → อัปเดต → **บันทึก CSV อัตโนมัติ**
* **ลบ (Delete) – ใช้งานจริงแล้ว**

  * รูปแบบ: พิมพ์เลขกรมธรรม์ → แปลงมาตรฐาน → แสดงรายการที่จะลบ → **ยืนยัน (y/n)**
    เมื่อลบสำเร็จ → **บันทึก CSV อัตโนมัติ**

## การทำงานเบื้องหลังที่ปรับปรุงแล้ว

* **Normalize ตอนโหลดไฟล์ (CSV load normalization):**
  เมื่อ `loadFromCSVFile()` จะ **แปลงเลขกรมธรรม์ให้เป็นมาตรฐาน** ก่อนใส่ลงหน่วยความจำ และเช็กซ้ำจากรูปแบบมาตรฐาน (ช่วยให้ค้นหา/อัปเดต/ลบ ตรงกันเสมอ)
* **แกนฟังก์ชันอัปเดต/ลบ (core) ใช้งานจริง**

  * `updatePolicyByNumber(...)` อัปเดตเฉพาะฟิลด์ที่ส่งมาและไม่ว่าง (วันที่ต้องผ่านการตรวจ)
  * `deletePolicyByNumber(...)` ลบด้วยการเลื่อนอาเรย์และลดตัวนับเรคคอร์ด
* **สไตล์โค้ดให้สม่ำเสมอ**

  * ใช้บล็อกคอมเมนต์ `/* ... */` สำหรับ **หัวฟังก์ชัน/หัวเซกชัน**
  * ใช้ `// ...` สำหรับคอมเมนต์สั้น/อินไลน์
  * ปีกกาแบบ **K\&R** (`if (...) { ... } else { ... }`) และรูปแบบ `} else {` เหมือนกันทั้งไฟล์
  * คอมเมนต์ utility แบบเดียวกัน เช่น `// ลบ \n/\r ที่ท้ายสตริง`

## เมนูการใช้งาน 

```
==== POLICY MANAGEMENT ====
1) List all policies
2) Add new policies
3) Search policies
4) Update a policy
5) Delete a policy
0) Exit program
```

## วิธีคอมไพล์และรัน

```bash
gcc main.c -o policy_manager
./policy_manager.exe
```

> โปรแกรมจะอ่าน/เขียน `policies.csv` ในโฟลเดอร์เดียวกับไฟล์ปฏิบัติการ

## กติกาข้อมูล & การตรวจสอบ (Validation)

* **PolicyNumber**

  * อินพุต: `[A-Z|a-z][0-9]{1,3}` → บันทึกในหน่วยความจำแบบ **A000–Z999** เสมอ
  * ห้ามซ้ำ (เช็กหลัง normalize)
* **StartDate**

  * อินพุต: `YYYY M D` หรือ `YYYY-M-D` → เก็บเป็น `YYYY-MM-DD`
  * ถ้ารูปแบบผิด จะไม่อัปเดต/ไม่บันทึก และแจ้งเตือน
* **CSV Header**

  * โปรแกรมจะข้ามแถวหัวตาราง และกัน header ที่เล็ดลอดเข้ามา

## ตัวอย่างไฟล์ CSV

```csv
PolicyNumber,OwnerName,CarModel,StartDate
P023,Alice,Toyota,2025-05-05
A007,Bob,Honda,2024-11-02
```

## Roadmap

* ตรวจ input วันเดือนปีตามปฏิทินจริง
* ปรับอินพุตเป็น `fgets + sscanf` เพื่อลดปัญหา buffer/space
* เพิ่มโหมด **เรียงลำดับ** และ **แบ่งหน้า (pagination)**
* วาง **Testing ตามแนว AAA/FIRST**

  * Unit: `normalizePolicy`, `parseAndFormatDate`, ค้นหาด้วย non-interactive wrapper
  * Integration: `save → load → verify` (round-trip)
  * E2E: เพิ่ม→บันทึก→รีเซ็ต→โหลด→ค้นหา→ตรวจจำนวน
  * (ออปชัน) ตรวจ memory error ด้วยเครื่องมือภายนอก

---


